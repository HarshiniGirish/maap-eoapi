---
name: "PyTest tests"
on:
    push:
        branches:
            - "tests-infra-pytest"

jobs:
    python-job:
        name: "PyTest tests"
        runs-on: ubuntu-latest
        steps:
          - name: Checkout repository
            uses: actions/checkout@v3

          - name: Setup Python
            uses: actions/setup-python@v3
            with:
                python-version: '3.11.4'

          - name: Assume Github OIDC role
            uses: aws-actions/configure-aws-credentials@v2
            with:
                aws-region: us-west-2
                role-to-assume: arn:aws:iam::916098889494:role/GithubOIDCRole-MAAP-Project-maap-eoapi-test
                role-session-name: maap-eoapi-test

          - name: Install dependencies
            run: |
                python -m pip install --upgrade pip
                pip install -r tests/requirements.txt

          - name: Run pytest
            run: |
                pytest tests